@model List<Veritabani_Odevi.DTOs.IndirimdekiKitapDTO>
@{
    ViewData["Title"] = "Aktif İndirimdeki Kitaplar";
}

<style>
    @@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    :root {
        --arka: #16202A;
        --kart: #1B2531;
        --input: #0F1620;
        --border: #2A3A4D;
        --yazi: #FFFFFF;
        --yazi-passive: #ADB5BD;
        --primary: #0D6EFD;
        --primary-hover: #0A58CA;
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--arka);
    }

    .page-header {
        background: var(--kart);
        padding: 40px 20px;
        border-radius: 15px;
        margin-bottom: 30px;
        text-align: center;
        border: 1px solid var(--border);
    }

        .page-header h2 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--yazi);
        }

        .page-header p {
            font-size: 1.1rem;
            color: var(--yazi-passive);
            margin: 0;
        }

    .book-card {
        border-radius: 12px;
        overflow: hidden;
        transition: all .3s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,.3);
        background: var(--kart);
        border: 1px solid var(--border);
        position: relative;
        height: 100%;
    }

        .book-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 10px 25px rgba(13, 110, 253, 0.3);
            border-color: var(--primary);
        }

    .book-img-wrapper {
        height: 280px;
        background: var(--input);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

        .book-img-wrapper img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
            transition: transform .3s ease;
        }

    .book-card:hover img {
        transform: scale(1.05);
    }

    .discount-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 25px;
        font-weight: 700;
        font-size: 0.95rem;
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
        z-index: 1;
    }

    .book-body {
        padding: 18px;
    }

    .book-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--yazi);
        margin-bottom: 6px;
        min-height: 50px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .book-author {
        font-size: 0.9rem;
        color: var(--yazi-passive);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

        .book-author::before {
            content: "✍️";
        }

    .categories {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 15px;
    }

    .category-tag {
        background: var(--primary);
        color: white;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
        border: 1px solid var(--primary-hover);
    }

    .price-section {
        padding-top: 12px;
        border-top: 1px solid var(--border);
        margin-bottom: 12px;
    }

    .original-price {
        color: var(--yazi-passive);
        text-decoration: line-through;
        font-size: 0.85rem;
        margin-bottom: 4px;
    }

    .discounted-price {
        font-size: 1.3rem;
        font-weight: 700;
        color: #28a745;
    }

    .savings {
        font-size: 0.8rem;
        color: #28a745;
        font-weight: 600;
        margin-top: 4px;
    }

    .end-date {
        display: flex;
        align-items: center;
        gap: 6px;
        color: var(--yazi-passive);
        font-size: 0.85rem;
        background: var(--input);
        padding: 8px 12px;
        border-radius: 8px;
        margin-bottom: 10px;
        border: 1px solid var(--border);
    }

        .end-date::before {
            content: "⏰";
            font-size: 1rem;
        }

    .add-cart-overlay {
        position: absolute;
        inset: 0;
        background: rgba(22, 32, 42, 0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity .3s ease;
        backdrop-filter: blur(4px);
    }

    .book-card:hover .add-cart-overlay {
        opacity: 1;
    }

    .add-cart-overlay button,
    .add-cart-overlay a {
        border-radius: 30px;
        padding: 12px 24px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .no-books {
        text-align: center;
        padding: 80px 20px;
        background: var(--kart);
        border-radius: 15px;
        border: 1px solid var(--border);
    }

        .no-books h3 {
            color: var(--yazi);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .no-books p {
            color: var(--yazi-passive);
            font-size: 1rem;
        }

    @@media (max-width: 768px) {
        .page-header h2 {
            font-size: 1.8rem;
        }

        .book-img-wrapper {
            height: 220px;
        }
    }
</style>

<div class="container mt-4">
    <div class="page-header">
        <h2>🔥 Aktif İndirimdeki Kitaplar</h2>
        <p>Kaçırılmayacak fırsatları keşfedin!</p>
    </div>

    @if (Model != null && Model.Any())
    {
        <div class="row g-4">
            @foreach (var k in Model)
            {
                var kategoriler = k.Kategoriler?.Split(',').Select(x => x.Trim()) ?? new List<string>();
                var tasarruf = k.OrijinalFiyat - k.IndirimliFiyat;

                <div class="col-md-3">
                    <div class="book-card">

                        <div class="book-img-wrapper">
                            <img src="@k.KapakResmiUrl" alt="@k.Baslik" />
                            <div class="discount-badge">%@k.IndirimOrani İNDİRİM</div>
                        </div>

                        <div class="book-body">
                            <div class="book-title">@k.Baslik</div>
                            <div class="book-author">@k.Yazar</div>

                            @if (kategoriler.Any())
                            {
                                <div class="categories">
                                    @foreach (var kategori in kategoriler)
                                    {
                                        <span class="category-tag">@kategori</span>
                                    }
                                </div>
                            }

                            <div class="price-section">
                                <div class="original-price">@k.OrijinalFiyat.ToString("C2")</div>
                                <div class="discounted-price">@k.IndirimliFiyat.ToString("C2")</div>
                                <div class="savings">@tasarruf.ToString("C2") tasarruf!</div>
                            </div>

                            <div class="end-date">
                                @k.BitisTarihi.ToShortDateString() tarihine kadar
                            </div>
                        </div>

                        <div class="add-cart-overlay">
                            <div class="d-flex flex-column gap-2 px-3">
                                <!-- Sepete Ekle -->
                                <form asp-controller="Sepet" asp-action="SepeteEkle" method="post">
                                    <input type="hidden" name="kitapId" value="@k.KitapID" />
                                    <button class="btn btn-success w-100">
                                        🛒 Sepete Ekle
                                    </button>
                                </form>

                                <!-- Detay & Yorumlar -->
                                <a asp-controller="Kitap"
                                   asp-action="Detay"
                                   asp-route-id="@k.KitapID"
                                   class="btn btn-outline-light w-100">
                                    💬 Detay & Yorumlar
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="no-books">
            <h3>😔 İndirim Bulunmuyor</h3>
            <p>Şu anda aktif indirimde kitap bulunmamaktadır.</p>
        </div>
    }
</div>